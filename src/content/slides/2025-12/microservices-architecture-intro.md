---
title: "微服务架构入门指南"
author: "foxgem"
description: "从单体到微服务的演进之路，理解微服务架构的核心概念、设计原则和实践挑战。"
pubDate: 2025-12-22
tags: ["microservices", "architecture", "backend", "distributed"]
theme: "black"
transition: "slide"
controls: true
progress: true
---

## 微服务架构入门指南

从单体应用到分布式系统

---

## 单体应用的困境

- 代码库庞大，难以理解和维护 <!-- .element: class="fragment" -->
- 部署周期长，牵一发而动全身 <!-- .element: class="fragment" -->
- 技术栈固化，难以采用新技术 <!-- .element: class="fragment" -->
- 扩展受限，无法按需伸缩 <!-- .element: class="fragment" -->

---

## 什么是微服务？

> 微服务是一种架构风格，将应用构建为一组小型服务的集合，每个服务运行在独立进程中，服务间通过轻量级机制通信。

— Martin Fowler

---

## 单体 vs 微服务

```
┌──────────────────┐     ┌─────┐ ┌─────┐ ┌─────┐
│                  │     │用户 │ │订单 │ │支付 │
│   单体应用        │  →  │服务 │ │服务 │ │服务 │
│   All in One     │     └──┬──┘ └──┬──┘ └──┬──┘
│                  │        │      │      │
└──────────────────┘     ───┴──────┴──────┴───
                              API Gateway
```

---

## 微服务核心特征

| 特征 | 说明 |
|-----|------|
| 服务独立 | 独立部署、独立扩展 |
| 技术多样 | 每个服务可用不同技术栈 |
| 去中心化 | 无单点故障 |
| 业务边界 | 按领域划分服务 |

---

## 服务拆分原则

### 领域驱动设计 (DDD)

```
限界上下文 (Bounded Context)
  ↓
识别核心域、支撑域、通用域
  ↓
每个限界上下文对应一个微服务
```

---

## 拆分示例：电商系统

```
┌─────────────────────────────────────────┐
│              电商系统                    │
├─────────┬─────────┬─────────┬──────────┤
│ 用户服务 │ 商品服务 │ 订单服务 │ 支付服务  │
├─────────┼─────────┼─────────┼──────────┤
│ 库存服务 │ 物流服务 │ 营销服务 │ 消息服务  │
└─────────┴─────────┴─────────┴──────────┘
```

---

## 服务间通信

### 同步通信 (REST/gRPC)

```
用户服务 ──HTTP/gRPC──→ 订单服务
         ←─ Response ──┘
```

### 异步通信 (消息队列)

```
订单服务 ──消息──→ [消息队列] ──消息──→ 库存服务
                             ──消息──→ 物流服务
```

---

## API Gateway

```
        ┌─────────────┐
Client →│ API Gateway │→ 用户服务
        │  - 路由     │→ 订单服务
        │  - 认证     │→ 商品服务
        │  - 限流     │
        │  - 聚合     │
        └─────────────┘
```

常用方案：Kong, Nginx, Spring Cloud Gateway

---

## 服务发现

```
┌──────────────┐
│ 服务注册中心  │ ← 服务A 注册
│  (Consul,    │ ← 服务B 注册
│   Nacos,     │
│   Etcd)      │ → 服务C 查询服务A地址
└──────────────┘
```

---

## 配置中心

- 集中管理配置 <!-- .element: class="fragment" -->
- 配置版本控制 <!-- .element: class="fragment" -->
- 配置热更新 <!-- .element: class="fragment" -->
- 环境隔离 <!-- .element: class="fragment" -->

常用方案：Nacos, Apollo, Spring Cloud Config

---

## 数据管理

### 每个服务独立数据库

```
用户服务 → [用户DB]
订单服务 → [订单DB]
商品服务 → [商品DB]
```

**挑战**：分布式事务、数据一致性

---

## 分布式事务解决方案

| 方案 | 一致性 | 复杂度 |
|-----|-------|-------|
| 2PC | 强一致 | 高 |
| TCC | 最终一致 | 高 |
| Saga | 最终一致 | 中 |
| 消息最终一致 | 最终一致 | 低 |

---

## 服务容错

### 熔断器模式

```
正常 → 失败率超阈值 → 熔断开启
  ↑                    ↓
  └── 恢复 ← 半开状态 ←┘
```

### 实现：Resilience4j, Sentinel

---

## 可观测性三支柱

```
┌─────────┐ ┌─────────┐ ┌─────────┐
│  Logs   │ │ Metrics │ │ Traces  │
│ 日志    │ │  指标   │ │  链路   │
└─────────┘ └─────────┘ └─────────┘
     ↓           ↓           ↓
   ELK      Prometheus   Jaeger
            Grafana      Zipkin
```

---

## 容器化部署

```yaml
# docker-compose.yml
services:
  user-service:
    image: user-service:latest
    ports:
      - "8001:8080"
  
  order-service:
    image: order-service:latest
    ports:
      - "8002:8080"
```

进阶：Kubernetes 编排

---

## 微服务的代价

- 分布式系统复杂度 <!-- .element: class="fragment" -->
- 运维成本增加 <!-- .element: class="fragment" -->
- 服务间调用延迟 <!-- .element: class="fragment" -->
- 数据一致性挑战 <!-- .element: class="fragment" -->
- 需要更多基础设施 <!-- .element: class="fragment" -->

---

## 什么时候用微服务？

✅ 适合：
- 大型复杂系统
- 需要独立扩展
- 多团队并行开发

❌ 不适合：
- 小型项目
- 团队经验不足
- 快速验证阶段

---

## 演进路径

```
单体应用
    ↓
模块化单体 (推荐先做)
    ↓
识别边界，逐步拆分
    ↓
微服务架构
```

**渐进式演进，不要一步到位**

---

## 总结

1. 微服务是**架构风格**，不是银弹
2. **领域驱动设计**指导服务拆分
3. 做好**可观测性**和**容错机制**
4. 从**模块化单体**开始演进
5. 技术复杂度换取**组织效率**

---

## 参考资源

- 《微服务设计》- Sam Newman
- 《领域驱动设计》- Eric Evans
- [microservices.io](https://microservices.io/)
- [12-Factor App](https://12factor.net/)

